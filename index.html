<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Animal Run</title>
  <style>
    :root{
      --sky1:#b3e5ff; --sky2:#6ec1ff; --ink:#0f172a; --panel:#ffffff;
      --barL:#22c55e; --barR:#ef4444; --rail:#cbd5e1; --accent:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif; color:var(--ink);
      background:linear-gradient(var(--sky1),var(--sky2));}
    .wrap{max-width:1100px; margin:auto; padding:16px; display:flex; flex-direction:column; gap:14px}

    header{display:flex; align-items:center; justify-content:space-between; gap:10px}
    h1{margin:0; font-size:28px}
    .btn{cursor:pointer; border:2px solid #0002; background:#ffd166; border-radius:12px; padding:10px 14px; font-weight:700}
    .panel{background:var(--panel); border:3px solid #0002; border-radius:18px}

    /* Gallery */
    .gallery{display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:12px; padding:12px}
    .card{border:3px solid #0002; border-radius:16px; padding:8px; cursor:pointer; background:#fff; transition:transform .08s}
    .card:hover{transform:translateY(-2px)}
    .thumb{width:100%; aspect-ratio:1/1; border-radius:12px; background:#eef; display:grid; place-items:center; overflow:hidden}
    .thumb img{width:100%; height:100%; object-fit:cover}
    .label{margin-top:6px; text-align:center; font-weight:700}

    /* Arena */
    .arena{display:none}
    .arena.show{display:block}
    .stage{position:relative; border:3px solid #0002; border-radius:18px; overflow:hidden; min-height:520px; background:
        radial-gradient(800px 300px at 50% 15%, #ffffff88, #0000 70%),
        linear-gradient(#dff2ff 0%, #bfe6ff 100%);
    }

    .fighter{position:absolute; bottom:120px; width:240px; height:240px; display:grid; place-items:center; filter:drop-shadow(0 12px 0 #0001)}
    .fighter img{width:100%; height:100%; object-fit:contain; border-radius:16px; background:#fff}
    .left{left:6%} .right{right:6%}

    /* HP bars + names */
    .hud{position:absolute; top:12px; left:0; right:0; display:flex; justify-content:space-between; padding:0 12px; gap:12px}
    .hpbox{flex:1; display:flex; flex-direction:column; gap:6px}
    .name{font-weight:800; text-shadow:0 1px 0 #fff}
    .bar{height:16px; background:var(--rail); border:2px solid #0002; border-radius:999px; overflow:hidden}
    .hp{height:100%; width:100%}
    .hpL{background:linear-gradient(90deg,var(--barL),#c0f2c9)}
    .hpR{background:linear-gradient(90deg,var(--barR),#fecaca)}

    .vs{position:absolute; top:8px; left:50%; transform:translateX(-50%); background:#fff; border:3px solid #0002; padding:4px 10px; border-radius:999px; font-weight:900}

    .log{margin:10px; padding:10px; border:3px solid #0002; border-radius:14px; background:#fff; min-height:48px}

    /* Simple 2D animations */
    @keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    @keyframes runL{0%{transform:translateX(0)} 50%{transform:translateX(160px)} 100%{transform:translateX(0)}}
    @keyframes runR{0%{transform:translateX(0)} 50%{transform:translateX(-160px)} 100%{transform:translateX(0)}}
    @keyframes collide{0%{transform:scale(1)} 40%{transform:scale(1.07) rotate(1.2deg)} 100%{transform:scale(1)}}
    .idle{animation:bob 1.1s ease-in-out infinite}

    /* Countdown */
    .count{position:absolute; inset:0; display:grid; place-items:center; font-size:110px; font-weight:900; color:#0008; text-shadow:0 4px 0 #fff}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üèÉ‚Äç‚ôÇÔ∏è Animal Run</h1>
      <div style="display:flex; gap:8px; align-items:center">
        <span class="toggle" style="margin-left:auto">
          <label><input type="checkbox" id="soundToggle" checked /> üîä Sound</label>
        </span>
        <button class="btn" id="goHome" style="display:none">Back to Gallery</button>
      </div>
    </header>

    <section class="panel" id="galleryPanel">
      <div class="gallery" id="gallery"></div>
    </section>

    <section class="arena" id="arena">
      <div class="stage" id="stage">
        <div class="hud">
          <div class="hpbox">
            <div class="name" id="nameL">Player</div>
            <div class="bar"><div class="hp hpL" id="hpLeft"></div></div>
          </div>
          <div class="hpbox" style="text-align:right">
            <div class="name" id="nameR">Opponent</div>
            <div class="bar"><div class="hp hpR" id="hpRight"></div></div>
          </div>
        </div>
        <div class="vs">VS</div>
        <div class="fighter left idle" id="boxL"><img id="imgL" alt="left animal"/></div>
        <div class="fighter right idle" id="boxR"><img id="imgR" alt="right animal"/></div>
        <div class="count" id="countdown" style="display:none">3</div>
      </div>
      <div class="log" id="log">Pick an animal to start‚Ä¶</div>
      <div style="display:flex; gap:8px; padding:8px 10px">
        <button class="btn" id="playAgain" style="display:none">Play again</button>
      </div>
    </section>
  </div>

  <script>
    // ---- PRELOADED ANIMALS ----
    const PRELOADED = [
      { name: 'Tiger',    src: 'assets/animals/Tiger.jpeg' },
      { name: 'Elephant', src: 'assets/animals/Elephant.jpeg' },
      { name: 'Fox',      src: 'assets/animals/Fox.jpeg' },
      { name: 'T-Rex',    src: 'assets/animals/Terex.jpeg' },
      { name: 'Bear',     src: 'assets/animals/Bear.jpeg' },
      { name: 'Wolf',     src: 'assets/animals/Wolf.jpeg' },
      { name: 'Brachiosaurus', src: 'assets/animals/Brachiosaurus.jpeg' },
      { name: 'Carnitaurus',   src: 'assets/animals/Carnitaurus.jpeg' },
      { name: 'Cat',      src: 'assets/animals/Cat.jpeg' },
      { name: 'Cheetah',  src: 'assets/animals/Cheetah.jpeg' },
      { name: 'Deloposaurus',  src: 'assets/animals/Deloposaurus.jpeg' },
      { name: 'Dog',      src: 'assets/animals/Dog.jpeg' },
      { name: 'Eagle',    src: 'assets/animals/Eagle.jpeg' },
      { name: 'Giginatosaurus', src: 'assets/animals/Giginatosaurus.jpeg' },
      { name: 'Lion',     src: 'assets/animals/Lion.jpeg' },
      { name: 'Monkey',   src: 'assets/animals/Monkey.jpeg' },
      { name: 'Rexosaurus', src: 'assets/animals/Rexosaurus.jpeg' },
      { name: 'Rhino',    src: 'assets/animals/Rhino.jpeg' },
      { name: 'Velociraptor', src: 'assets/animals/Velociraptor.jpeg' }
    ];

    const gallery = document.getElementById('gallery');
    const arena = document.getElementById('arena');
    const imgL = document.getElementById('imgL');
    const imgR = document.getElementById('imgR');
    const boxL = document.getElementById('boxL');
    const boxR = document.getElementById('boxR');
    const nameL = document.getElementById('nameL');
    const nameR = document.getElementById('nameR');
    const hpLeft = document.getElementById('hpLeft');
    const hpRight = document.getElementById('hpRight');
    const countdownEl = document.getElementById('countdown');
    const log = document.getElementById('log');
    const soundToggle = document.getElementById('soundToggle');

    // ---- SOUND ENGINE ----
    class Sound {
      constructor() {
        this.ctx = null;
        this.enabled = true;
        document.addEventListener('click', () => this._ensure(), { once: true });
      }
      _ensure() {
        if (!this.ctx) {
          try { this.ctx = new (window.AudioContext || window.webkitAudioContext)(); }
          catch(_) { this.enabled = false; }
        }
      }
      setEnabled(on){ this.enabled = !!on; }
      now(){ return this.ctx ? this.ctx.currentTime : 0; }
      _note({type='sine', freq=440, dur=0.15, gain=0.2, attack=0.005, decay=0.1, detune=0}){
        if(!this.enabled) return;
        this._ensure(); if(!this.ctx) return;
        const t0 = this.now();
        const o = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        o.type = type; o.frequency.value = freq; o.detune.value = detune;
        g.gain.setValueAtTime(0, t0);
        g.gain.linearRampToValueAtTime(gain, t0 + attack);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + attack + decay + dur);
        o.connect(g).connect(this.ctx.destination);
        o.start(t0); o.stop(t0 + attack + decay + dur + 0.05);
      }
      _noise({dur=0.25, gain=0.25, type='white', lp=4000}){
        if(!this.enabled) return;
        this._ensure(); if(!this.ctx) return;
        const t0 = this.now();
        const bufferSize = Math.floor(this.ctx.sampleRate * dur);
        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i=0;i<bufferSize;i++){
          const w = Math.random()*2-1;
          data[i] = type==='white'? w : data[i-1]*0.98 + w*0.02;
        }
        const src = this.ctx.createBufferSource();
        src.buffer = buffer;

        const filt = this.ctx.createBiquadFilter(); filt.type='lowpass'; filt.frequency.value=lp;
        const g = this.ctx.createGain(); g.gain.value = gain;

        src.connect(filt).connect(g).connect(this.ctx.destination);
        src.start(t0); src.stop(t0+dur);
      }
      tick(){ this._note({type:'square', freq:880, dur:0.05, gain:0.12}); }
      go(){ this._note({type:'triangle', freq:523.25, dur:0.25, gain:0.25}); }
      door(){ this._note({type:'sawtooth', freq:140, dur:0.4, gain:0.2}); }
      run(){ this._noise({dur:0.20, gain:0.18, type:'brown', lp:1200}); }
      hit(){ this._noise({dur:0.18, gain:0.22, type:'white', lp:2200}); this._note({type:'triangle', freq:220, dur:0.12, gain:0.18}); }
      win(){ this._note({type:'sine', freq:659.25, dur:0.18, gain:0.22}); setTimeout(()=>this._note({type:'sine', freq:783.99, dur:0.22, gain:0.22}),120); setTimeout(()=>this._note({type:'sine', freq:987.77, dur:0.30, gain:0.22}),260); }
    }
    const S = new Sound();
    soundToggle.addEventListener('change', e=> S.setEnabled(e.target.checked));

    // ---- GAMEPLAY LOGIC ----
    let animals = PRELOADED.slice();

    const el = (t,a={},...c)=>{const n=document.createElement(t);Object.entries(a).forEach(([k,v])=>{if(k==='style'&&typeof v==='object')Object.assign(n.style,v);else if(k.startsWith('on'))n.addEventListener(k.slice(2),v);else n.setAttribute(k,v)});c.flat().forEach(x=>n.appendChild(typeof x==='string'?document.createTextNode(x):x));return n};

    function renderGallery(){ gallery.innerHTML=''; animals.forEach((a,i)=>{
      gallery.appendChild(el('button',{class:'card',onclick:()=>selectAnimal(i)},
        el('div',{class:'thumb'}, el('img',{src:a.src,alt:a.name})),
        el('div',{class:'label'}, a.name)) );
    }); }

    function selectAnimal(index){
      if(animals.length<2){ alert('Add at least two animals.'); return; }
      const p=animals[index]; let j=index; while(j===index) j=Math.floor(Math.random()*animals.length); const o=animals[j];
      document.getElementById('galleryPanel').style.display='none';
      arena.classList.add('show'); document.getElementById('goHome').style.display='inline-block';
      imgL.src=p.src; imgR.src=o.src; nameL.textContent=p.name; nameR.textContent=o.name;
      hpLeft.style.width='100%'; hpRight.style.width='100%';
      log.textContent = `${p.name} prepares to run!`;
      S.door();
      setTimeout(()=>{ S.run(); countdown(()=> startFight(p,o)); },700);
    }

    function countdown(done){
      countdownEl.style.display='grid'; let n=3; countdownEl.textContent=n;
      const t=setInterval(()=>{
        n--;
        if(n>0){ countdownEl.textContent=n; S.tick(); }
        else { countdownEl.textContent='Go!'; S.go(); setTimeout(()=>{ countdownEl.style.display='none'; clearInterval(t); done(); },550); }
      },650);
    }

    function startFight(p,o){
      boxL.classList.add('idle'); boxR.classList.add('idle');
      let L=100, R=100; let turn=0;
      const tick=setInterval(()=>{
        const dmg = 8+Math.floor(Math.random()*13);
        if(turn===0){
          charge(boxL,'L'); S.hit();
          R=Math.max(0,R-dmg); hpRight.style.width=R+'%'; log.textContent=`${p.name} hits ${o.name} for ${dmg}!`;
        }else{
          charge(boxR,'R'); S.hit();
          L=Math.max(0,L-dmg); hpLeft.style.width=L+'%'; log.textContent=`${o.name} hits ${p.name} for ${dmg}!`;
        }
        if(L===0||R===0){ clearInterval(tick); const winner = R===0&&

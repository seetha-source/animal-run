<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Animal Battle ‚Äî Minimal</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb; --win:#22c55e; --lose:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif; background:var(--bg); color:var(--text);}
    .container{max-width:1000px; margin:auto; padding:16px; display:flex; flex-direction:column; gap:12px}
    h1{margin:0 0 4px; font-size:22px}
    .panel{background:#0b1220; border:1px solid #1f2937; border-radius:14px}

    /* Controls */
    .controls{display:flex; gap:10px; flex-wrap:wrap; padding:10px}
    .controls input{background:#0b1220; border:1px solid #1f2937; color:var(--text); border-radius:10px; padding:8px 10px}
    .btn{cursor:pointer; background:#0d1b2a; color:var(--text); border:1px solid #1f2937; border-radius:10px; padding:8px 12px}

    /* Gallery */
    .gallery{display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:10px; padding:10px}
    .card{border:1px solid #1f2937; border-radius:12px; overflow:hidden; background:#0b1220; cursor:pointer}
    .thumb{aspect-ratio:1/1; width:100%; background:#111 center/cover no-repeat}
    .label{padding:8px 10px; font-size:13px; color:var(--muted)}

    /* Arena */
    .arena{display:none; padding:10px}
    .arena.show{display:block}
    .stage{position:relative; min-height:320px; border:1px solid #1f2937; border-radius:12px; background:#0b1324; overflow:hidden}
    .fighter{position:absolute; bottom:12px; width:160px; aspect-ratio:1; background:#111 center/cover no-repeat; border-radius:12px}
    .fighter.left{left:8%}
    .fighter.right{right:8%}

    .hpbar{position:absolute; top:10px; width:44%; height:10px; background:#0c1422; border:1px solid #1f2937; border-radius:999px; overflow:hidden}
    .hpbar.left{left:10px}
    .hpbar.right{right:10px}
    .hp{height:100%; width:100%; background:linear-gradient(90deg,var(--win),#a3e635)}

    .log{margin-top:10px; padding:8px 10px; border:1px solid #1f2937; border-radius:10px; min-height:44px; color:var(--muted); font-size:14px; max-height:130px; overflow:auto}

    footer{font-size:12px; color:var(--muted); text-align:center; padding:6px 0 10px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üêæ Animal Battle ‚Äî Minimal</h1>
      <div style="font-size:13px; color:var(--muted)">Preloaded animals. No cage or effects. Super lightweight.</div>
    </header>

    <!-- Controls -->
    <div class="panel controls">
      <div style="display:flex; gap:8px; flex-wrap:wrap">
        <input id="nameInput" type="text" placeholder="Animal name (optional)" />
        <input id="urlInput" type="url" placeholder="Paste image URL (HTTPS)" />
        <button class="btn" id="addUrl">Add by URL</button>
        <input id="fileInput" type="file" accept="image/*" multiple />
      </div>
      <button class="btn" id="resetAll">Reset</button>
    </div>

    <!-- Gallery -->
    <section class="panel" id="galleryPanel">
      <div class="gallery" id="gallery"></div>
    </section>

    <!-- Arena -->
    <section class="panel arena" id="arena" aria-live="polite">
      <div class="stage" id="stage">
        <div class="hpbar left" aria-hidden="true"><div class="hp" id="hpLeft"></div></div>
        <div class="hpbar right" aria-hidden="true"><div class="hp" id="hpRight"></div></div>
        <div class="fighter left" id="fighterLeft"></div>
        <div class="fighter right" id="fighterRight"></div>
      </div>
      <div class="log" id="log">Pick an animal to fight‚Ä¶</div>
      <div style="display:flex; gap:8px; padding:8px 0">
        <button class="btn" id="playAgain" style="display:none">Play again</button>
        <button class="btn" id="backToGallery" style="display:none">Back to gallery</button>
      </div>
    </section>

    <footer>Single file ‚Ä¢ No libraries ‚Ä¢ Works on GitHub Pages</footer>
  </div>

  <script>
    // --- State ---
    const gallery = document.getElementById('gallery');
    const arena = document.getElementById('arena');
    const stage = document.getElementById('stage');
    const fighterLeft = document.getElementById('fighterLeft');
    const fighterRight = document.getElementById('fighterRight');
    const hpLeft = document.getElementById('hpLeft');
    const hpRight = document.getElementById('hpRight');
    const log = document.getElementById('log');

    let animals = [];// {name, src}

    // --- Utilities ---
    const el = (tag, attrs={}, ...children)=>{ const n=document.createElement(tag); Object.entries(attrs).forEach(([k,v])=>{ if(k=="style"&&typeof v=="object") Object.assign(n.style,v); else if(k.startsWith('on')) n.addEventListener(k.slice(2), v); else n.setAttribute(k,v);}); children.flat().forEach(c=> n.appendChild(typeof c==="string"? document.createTextNode(c): c)); return n; };

    function addAnimal(src, name){ animals.push({name: name?.trim() || inferName(src), src}); renderGallery(); }
    function inferName(src){ try{ const u=new URL(src); const f=u.pathname.split('/').pop(); return (f?.split('.')?.[0]||'Animal').replace(/[-_]/g,' ');}catch{ return 'Animal'; } }

    function renderGallery(){
      gallery.innerHTML='';
      animals.forEach((a,i)=>{
        const card = el('button',{class:'card', onclick:()=> selectAnimal(i)},
          el('div',{class:'thumb', style:{backgroundImage:`url(${a.src})`}}),
          el('div',{class:'label'}, a.name)
        );
        gallery.appendChild(card);
      });
    }

    // --- Add by URL / File ---
    document.getElementById('addUrl').addEventListener('click',()=>{
      const url=document.getElementById('urlInput').value.trim();
      const name=document.getElementById('nameInput').value.trim();
      if(!url) return alert('Paste an image URL first.');
      addAnimal(url, name||undefined);
      document.getElementById('urlInput').value='';
      document.getElementById('nameInput').value='';
    });
    const fileInput=document.getElementById('fileInput');
    fileInput.addEventListener('change', handleFiles);
    function handleFiles(e){
      const files=Array.from(e.target.files||[]);
      files.forEach(f=>{ if(!f.type.startsWith('image/')) return; const r=new FileReader(); r.onload=()=> addAnimal(r.result, f.name.replace(/\.[^.]+$/, '')); r.readAsDataURL(f); });
      fileInput.value='';
    }

    // --- Game (minimal) ---
    function selectAnimal(index){
      if(animals.length<2){ alert('Add at least two animals.'); return; }
      const p=animals[index];
      let j=index; while(j===index) j=Math.floor(Math.random()*animals.length);
      const o=animals[j];

      // Setup arena immediately (no cage/effects)
      document.getElementById('galleryPanel').style.display='none';
      arena.classList.add('show');
      fighterLeft.style.backgroundImage=`url(${p.src})`;
      fighterRight.style.backgroundImage=`url(${o.src})`;
      hpLeft.style.width='100%'; hpRight.style.width='100%';
      startFight(p,o);
    }

    function startFight(p,o){
      log.textContent = `${p.name} vs ${o.name} ‚Äî Fight!`;
      let L=100, R=100;
      const tick=setInterval(()=>{
        const leftAttacks = Math.random()<0.5;
        const dmg = 8+Math.floor(Math.random()*13); // 8‚Äì20
        if(leftAttacks){ R=Math.max(0,R-dmg); hpRight.style.width=R+'%'; log.append(`
${p.name} hits ${o.name} for ${dmg}.`); }
        else { L=Math.max(0,L-dmg); hpLeft.style.width=L+'%'; log.append(`
${o.name} strikes ${p.name} for ${dmg}.`); }
        if(L===0||R===0){ clearInterval(tick); const winner = R===0&&L>0 ? p : (L===0&&R>0 ? o : (Math.random()<0.5?p:o)); log.append(`
üèÜ ${winner.name} wins!`); document.getElementById('playAgain').style.display='inline-block'; document.getElementById('backToGallery').style.display='inline-block'; }
      }, 800);
    }

    // Buttons
    document.getElementById('playAgain').addEventListener('click',()=>{ log.textContent='Pick an animal to fight‚Ä¶'; document.getElementById('playAgain').style.display='none'; document.getElementById('backToGallery').style.display='none'; arena.classList.remove('show'); document.getElementById('galleryPanel').style.display='block'; });
    document.getElementById('backToGallery').addEventListener('click',()=>{ document.getElementById('playAgain').click(); });
    document.getElementById('resetAll').addEventListener('click',()=>{ if(confirm('Clear all animals and reload defaults?')){ animals=[]; preload(); }});

    // --- Preloaded animals (built-in SVGs so it works offline & on GitHub Pages) ---
    function svg(text, color){ return `data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 300'><defs><linearGradient id='g' x1='0' x2='0' y1='0' y2='1'><stop offset='0' stop-color='${color}' stop-opacity='.85'/><stop offset='1' stop-color='${color}' stop-opacity='.45'/></linearGradient></defs><rect width='100%' height='100%' fill='url(#g)'/><text x='50%' y='54%' text-anchor='middle' font-family='Segoe UI,Arial' font-size='64' fill='white' opacity='.98' font-weight='700'>${text}</text></svg>`)}`; }

    function preload(){
      const defaults=[
        {name:'Lion', src: svg('Lion','#f59e0b')},
        {name:'Tiger', src: svg('Tiger','#ef4444')},
        {name:'Bear', src: svg('Bear','#22c55e')},
        {name:'Wolf', src: svg('Wolf','#60a5fa')},
        {name:'Elephant', src: svg('Elephant','#a78bfa')},
        {name:'Horse', src: svg('Horse','#f472b6')}
      ];
      animals = defaults.slice();
      renderGallery();
    }

    // init
    preload();
  </script>
</body>
</html>
